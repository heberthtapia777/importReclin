

function minimizar(c){$("."+c).slideToggle();var b=c;var a=b.split("chat");$("#chat_box_"+a[1]).mCustomScrollbar("scrollTo","bottom")}function cerrar(a){$("aside").remove("#"+a);num=1;$("#sidebar aside").each(function(b){a=$(this).attr("id");r=((280*num)+30);$("aside#"+a).css("right",r+"px");num++})}Push.create("Bienbenido al CHAT...!!!",{body:"Este es el cuerpo de la notificaciÃ³n.",icon:"images/logo-elviejoroble.png",timeout:4000,onClick:function(){this.close()}});function obtenerSession(){var a;$.ajax({url:"modulo/chat/obtenerSession.php",type:"post",async:false,success:function(b){a=b},error:function(b){}});return a}function chatClickSend(b,c){var a=obtenerSession();num=$("#sidebar > aside").length;sw=0;$("#sidebar aside").each(function(d){id=$(this).attr("id");a=new String(a);b=new String(b);stringB=a.concat(b);if(id==stringB&&a==c.userTo){sw=1;sendMessage(c);$("#audio4")[0].play()}});if(sw===0){$.ajax({url:"modulo/chat/sidebarChat.php",type:"POST",async:true,data:{userTo:b,num:num,userFrom:a}}).done(function(d){console.log("success");if(a==c.userTo){$("#sidebar").append(d);$("#chat_box_"+a+b).mCustomScrollbar({autoHideScrollbar:true});$("#audio4")[0].play()}}).fail(function(){console.log("error")}).always(function(){console.log("complete");$("#chat_box_"+a+b).mCustomScrollbar("scrollTo","bottom");sendMessage(c)})}}function chatClick(b,a){num=$("#sidebar > aside").length;sw=0;$("#sidebar aside").each(function(c){id=$(this).attr("id");a=new String(a);b=new String(b);stringB=a.concat(b);if(id==stringB){sw=1}});if(sw===0){$.ajax({url:"modulo/chat/sidebarChat.php",type:"POST",async:true,data:{userTo:b,num:num,userFrom:a}}).done(function(c){console.log("success");$("#sidebar").append(c);var d=$("#chat"+a+b).prop("scrollHeight");$("#chat_box_"+a+b).mCustomScrollbar({autoHideScrollbar:true})}).fail(function(){console.log("error")}).always(function(){console.log("complete");$("#chat_box_"+a+b).mCustomScrollbar("scrollTo","bottom");$("#submit_message"+b).focus()})}}var pusher=new Pusher("4e89620472fb0a58c62c");var canal=pusher.subscribe("canalTractoCat");$(function(){canal.bind("nuevo_comentario",function(a){chatClickSend(a.userFrom,a)});$(".content").mCustomScrollbar()});function sendMessage(a){f=$("div#chat_box_"+a.userTo+a.userFrom+" div.chat_message_wrapper:last").hasClass("chat_message_right").toString();if(f=="true"){t='<div class="chat_message_wrapper">';t+='<div class="chat_user_avatar">';t+='<img class="thumb md-user-image" src="thumb/phpThumb.php?src=../modulo/empleado/uploads/'+a.foto+'&w=32&h=32&far=1&bg=FFFFFF&hash=361c2f150d825e79283a1dcc44502a76" alt="Foto de Perfil" title="Foto de Perfil">';t+="</div>";t+='	<ul class="chat_message">';t+="        <li>";t+="            <p>"+a.mensaje+"</p>";t+="        </li>";t+="    </ul> </div>";$("div#chat_box_"+a.userTo+a.userFrom).find("div.mCSB_container").append(t);$("aside#"+a.userTo+a.userFrom).find("div.popup-head").addClass("parpadea");$("aside#"+a.userTo+a.userFrom).find("div.parpadea").removeClass("popup-head")}else{if($("div#chat_box_"+a.userTo+a.userFrom).find("div.mCSB_container").is(":empty")){t='<div class="chat_message_wrapper">';t+='<div class="chat_user_avatar">';t+='     <img class="thumb md-user-image" src="thumb/phpThumb.php?src=../modulo/empleado/uploads/'+a.foto+'&w=32&h=32&far=1&bg=FFFFFF&hash=361c2f150d825e79283a1dcc44502a76" alt="Foto de Perfil" title="Foto de Perfil">';t+="</div>";t+='	<ul class="chat_message">';t+="        <li>";t+="            <p>"+a.mensaje+"</p>";t+="        </li>";t+="    </ul> </div>";$("div#chat_box_"+a.userTo+a.userFrom).find("div.mCSB_container").append(t);$("aside#"+a.userTo+a.userFrom).find("div.popup-head").addClass("parpadea");$("aside#"+a.userTo+a.userFrom).find("div.parpadea").removeClass("popup-head")}else{$("div#chat_box_"+a.userTo+a.userFrom+" div.chat_message_wrapper:last").find("ul").append("<li><p>"+a.mensaje+"</p></li>");$("aside#"+a.userTo+a.userFrom).find("div.popup-head").addClass("parpadea");$("aside#"+a.userTo+a.userFrom).find("div.parpadea").removeClass("popup-head")}}$.ajax({url:"modulo/chat/saveMessage.php",type:"POST",data:{userFrom:a.userTo,userTo:a.userFrom,message:a.mensaje},}).done(function(b){console.log("success")}).fail(function(){console.log("error")}).always(function(){console.log("complete")});$("#chat_box_"+a.userTo+a.userFrom).mCustomScrollbar("scrollTo","bottom")}function sendSubmit(a,b){r=$("div#chat_box_"+b+a+" div.chat_message_wrapper:last").hasClass("chat_message_right").toString();if(r=="true"){$.post("modulo/chat/ajax.php",{msj:$("#submit_message"+a).val(),userFrom:b,userTo:a,socket_id:pusher.connection.socket_id},function(c){$("div#chat_box_"+c.userFrom+a+" div.chat_message_wrapper:last").find("ul").append('<li id="effect"><p>'+c.mensaje+"</p></li>")},"json").always(function(c){console.log("complete");$("#chat_box_"+c.userFrom+a).mCustomScrollbar("scrollTo","bottom");$("#submit_message"+a).val("");limpNMessaje(c.userFrom+a)});return false}else{$.post("modulo/chat/ajax.php",{msj:$("#submit_message"+a).val(),userFrom:b,userTo:a,socket_id:pusher.connection.socket_id},function(c){t='<div class="chat_message_wrapper chat_message_right">';t+='<div class="chat_user_avatar">';t+='     <img class="thumb md-user-image" src="thumb/phpThumb.php?src=../modulo/empleado/uploads/'+c.foto+'&w=32&h=32&far=1&bg=FFFFFF&hash=361c2f150d825e79283a1dcc44502a76" alt="Foto de Perfil" title="Foto de Perfil">';t+="</div>";t+='	<ul class="chat_message">';t+="        <li>";t+="            <p>"+c.mensaje+"</p>";t+="        </li>";t+="    </ul> </div>";$("div#chat_box_"+c.userFrom+a).find("div.mCSB_container").append(t)},"json").always(function(c){console.log("complete");$("#chat_box_"+c.userFrom+a).mCustomScrollbar("scrollTo","bottom");$("#submit_message"+a).val("");limpNMessaje(c.userFrom+a)});return false}}function limpNMessaje(a){$("aside#"+a).find("div.parpadea").addClass("popup-head");$("aside#"+a).find("div.popup-head").removeClass("parpadea")};

